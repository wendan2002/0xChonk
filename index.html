<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>0xChonk - Fat Cat Protocol</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts (Pixel Style) -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #0f172a; /* Slate 900 */
            color: white;
            overflow: hidden; /* é˜²æ­¢æ»¾å‹• */
            user-select: none; /* é˜²æ­¢é¸å–æ–‡å­— */
            -webkit-tap-highlight-color: transparent;
        }
        
        /* èƒ–è²“çš„å‹•ç•« */
        .cat-bounce {
            transition: transform 0.1s;
        }
        .cat-bounce:active {
            transform: scale(0.95);
        }
        
        /* æµ®å‹•æ•¸å­—å‹•ç•« */
        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-100px) scale(1.5); }
        }
        .float-number {
            position: absolute;
            pointer-events: none;
            animation: floatUp 0.8s ease-out forwards;
            font-weight: bold;
            font-family: 'Press Start 2P', cursive;
            text-shadow: 2px 2px 0px #000;
            z-index: 50;
        }

        /* é€ å‹æ¿¾é¡ */
        .skin-default { filter: none; }
        .skin-gold { filter: drop-shadow(0 0 10px gold) sepia(1) saturate(5); }
        .skin-hacker { filter: drop-shadow(0 0 5px #0f0) hue-rotate(90deg) contrast(1.2); }
        .skin-neon { filter: drop-shadow(0 0 10px #f0f) hue-rotate(280deg); }

        /* èƒ½é‡æ¢å‹•ç•« */
        .progress-bar {
            transition: width 0.5s ease-out;
        }

        /* è½‰ç›¤æ¨£å¼ */
        .wheel-container {
            position: relative;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            border: 4px solid #facc15;
            overflow: hidden;
            transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99);
            background: conic-gradient(
                #ef4444 0deg 45deg, 
                #3b82f6 45deg 90deg, 
                #22c55e 90deg 135deg, 
                #eab308 135deg 180deg, 
                #a855f7 180deg 225deg, 
                #ec4899 225deg 270deg, 
                #f97316 270deg 315deg, 
                #64748b 315deg 360deg
            );
        }
        .wheel-pointer {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 20;
            width: 0; 
            height: 0; 
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 30px solid white;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.5));
        }

        /* è‡ªå®šç¾©æ»¾å‹•æ¢ (ç”¨æ–¼æ’è¡Œæ¦œ) */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #1e293b; 
        }
        ::-webkit-scrollbar-thumb {
            background: #475569; 
            border-radius: 3px;
        }
    </style>
</head>
<body class="h-screen w-screen flex flex-col relative">

    <!-- ç²’å­èƒŒæ™¯ (æ¨¡æ“¬) -->
    <div id="bg-particles" class="absolute inset-0 pointer-events-none opacity-20 z-0"></div>

    <!-- é ‚éƒ¨è³‡è¨Šæ¬„ -->
    <div class="z-10 w-full px-4 pt-4 pb-2 bg-slate-900/90 backdrop-blur border-b border-slate-700 flex justify-between items-center shadow-lg">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 rounded-full bg-yellow-500 flex items-center justify-center text-slate-900 font-bold border-2 border-white">
                <i class="fa-solid fa-cat"></i>
            </div>
            <div>
                <div class="text-xs text-slate-400 font-bold">0xChonk</div>
                <div class="text-[10px] bg-purple-600 px-1 rounded text-white inline-block">LV.<span id="level-display">1</span></div>
            </div>
        </div>
        <div class="text-right">
            <div class="text-xs text-slate-400">éŒ¢åŒ…é¤˜é¡</div>
            <div class="text-xl font-black text-yellow-400 font-mono tracking-wider flex items-center gap-1 justify-end">
                <img src="https://cryptologos.cc/logos/solana-sol-logo.png" class="w-4 h-4" alt="SOL">
                <span id="score-display">0</span>
            </div>
        </div>
    </div>

    <!-- ä¸»è¦å…§å®¹å€åŸŸ (åˆ‡æ›) -->
    <main id="main-container" class="flex-1 relative overflow-y-auto z-10 pb-20">
        
        <!-- é é¢ 1: é¦–é  (é»æ“ŠæŒ–ç¤¦) -->
        <div id="page-home" class="page-content h-full flex flex-col items-center justify-center">
            
            <!-- èƒ½é‡æ¢ -->
            <div class="w-3/4 mb-6">
                <div class="flex justify-between text-xs text-slate-300 mb-1">
                    <span>âš¡ é«”åŠ›å€¼</span>
                    <span><span id="energy-current">1000</span>/<span id="energy-max">1000</span></span>
                </div>
                <div class="w-full bg-slate-700 rounded-full h-3 overflow-hidden border border-slate-600">
                    <div id="energy-bar" class="bg-gradient-to-r from-yellow-400 to-orange-500 h-3 rounded-full progress-bar" style="width: 100%"></div>
                </div>
            </div>

            <!-- å¤§èƒ–è²“ (é»æ“Šå€åŸŸ) -->
            <div class="relative w-64 h-64 flex items-center justify-center cursor-pointer select-none" id="click-zone">
                <!-- å…‰æšˆæ•ˆæœ -->
                <div class="absolute inset-0 bg-yellow-500 blur-3xl opacity-10 rounded-full animate-pulse"></div>
                
                <!-- è²“å’ª SVG -->
                <div id="cat-avatar" class="cat-bounce skin-default w-full h-full relative z-10">
                    <!-- ä½¿ç”¨ SVG ç¹ªè£½ä¸€éš»åƒç´ é¢¨æ ¼çš„èƒ–æ©˜è²“ -->
                    <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" class="w-full h-full drop-shadow-2xl">
                        <!-- èº«é«” -->
                        <rect x="40" y="60" width="120" height="110" rx="40" fill="#fb923c" />
                        <!-- è‚šå­ -->
                        <ellipse cx="100" cy="120" rx="40" ry="35" fill="#fed7aa" />
                        <!-- è€³æœµ -->
                        <polygon points="50,70 30,30 80,60" fill="#fb923c" />
                        <polygon points="150,70 170,30 120,60" fill="#fb923c" />
                        <!-- çœ¼ç› -->
                        <rect x="65" y="85" width="15" height="15" rx="5" fill="#1e293b" />
                        <rect x="120" y="85" width="15" height="15" rx="5" fill="#1e293b" />
                        <!-- å˜´å·´ -->
                        <path d="M 90 110 Q 100 120 110 110" stroke="#7c2d12" stroke-width="3" fill="none" />
                        <!-- èŠ±ç´‹ -->
                        <rect x="90" y="60" width="20" height="10" rx="2" fill="#c2410c" />
                        <rect x="40" y="100" width="10" height="20" rx="2" fill="#c2410c" />
                        <rect x="150" y="100" width="10" height="20" rx="2" fill="#c2410c" />
                        <!-- æ‰‹æŒç‰©å“ (éš¨æ©Ÿå‡ºç¾) -->
                    </svg>
                </div>
            </div>

            <div class="mt-8 text-center animate-bounce text-slate-400 text-sm">
                ğŸ‘† ç˜‹ç‹‚é»æ“Š 0xChonk
            </div>
        </div>

        <!-- é é¢ 2: ä»»å‹™ (Earn) -->
        <div id="page-earn" class="page-content hidden p-4">
            <h2 class="text-2xl font-bold text-center mb-6 text-yellow-400 font-['Press_Start_2P'] uppercase">ä»»å‹™ç‰†</h2>
            
            <div class="space-y-4">
                <!-- æ¯æ—¥ç°½åˆ° -->
                <div class="bg-slate-800 rounded-xl p-4 border border-slate-700 flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-blue-500/20 rounded-lg flex items-center justify-center text-blue-400">
                            <i class="fa-solid fa-calendar-check"></i>
                        </div>
                        <div>
                            <div class="font-bold">æ¯æ—¥ç°½åˆ°</div>
                            <div class="text-xs text-slate-400">+1,000 Pts</div>
                        </div>
                    </div>
                    <button id="btn-daily-checkin" class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg text-sm font-bold transition">é ˜å–</button>
                </div>

                <!-- ç¤¾äº¤ä»»å‹™ -->
                <div class="bg-slate-800 rounded-xl p-4 border border-slate-700 flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-sky-500/20 rounded-lg flex items-center justify-center text-sky-400">
                            <i class="fa-brands fa-twitter"></i>
                        </div>
                        <div>
                            <div class="font-bold">è¿½è¹¤ Twitter</div>
                            <div class="text-xs text-slate-400">+5,000 Pts</div>
                        </div>
                    </div>
                    <button onclick="completeTask('twitter', 5000, 'https://twitter.com/0xChonk')" id="btn-task-twitter" class="bg-slate-600 hover:bg-slate-500 text-white px-4 py-2 rounded-lg text-sm font-bold transition">å»è¿½è¹¤</button>
                </div>

                <div class="bg-slate-800 rounded-xl p-4 border border-slate-700 flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-blue-400/20 rounded-lg flex items-center justify-center text-blue-300">
                            <i class="fa-brands fa-telegram"></i>
                        </div>
                        <div>
                            <div class="font-bold">åŠ å…¥ TG é »é“</div>
                            <div class="text-xs text-slate-400">+5,000 Pts</div>
                        </div>
                    </div>
                    <button onclick="completeTask('telegram', 5000, '#')" id="btn-task-telegram" class="bg-slate-600 hover:bg-slate-500 text-white px-4 py-2 rounded-lg text-sm font-bold transition">åŠ å…¥</button>
                </div>
            </div>
            
            <!-- é‚€è«‹å¥½å‹ -->
            <div class="mt-8 bg-gradient-to-r from-purple-900 to-indigo-900 rounded-xl p-6 border border-purple-500/30 text-center">
                <h3 class="text-lg font-bold mb-2">é‚€è«‹å¥½å‹ (Frens)</h3>
                <p class="text-sm text-slate-300 mb-4">æ¯é‚€è«‹ä¸€ä½å¥½å‹ï¼Œé›™æ–¹å„å¾— 25,000 Pts</p>
                <div class="bg-black/30 p-2 rounded text-xs break-all font-mono mb-4 text-slate-400" id="invite-link">https://t.me/ChonkBot?start=ref_123</div>
                <button onclick="copyInvite()" class="w-full bg-yellow-500 hover:bg-yellow-400 text-black font-bold py-3 rounded-lg shadow-[0_4px_0_rgb(180,83,9)] active:shadow-none active:translate-y-[4px] transition">
                    è¤‡è£½é€£çµ
                </button>
            </div>
        </div>

        <!-- é é¢ 3: å•†åº— (Shop) -->
        <div id="page-shop" class="page-content hidden p-4">
            <h2 class="text-2xl font-bold text-center mb-6 text-yellow-400 font-['Press_Start_2P'] uppercase">é»‘å¸‚å•†åº—</h2>

            <!-- å‡ç´šé“å…· -->
            <div class="mb-6">
                <h3 class="text-sm text-slate-400 uppercase tracking-wider mb-3 font-bold">èƒ½åŠ›å‡ç´š</h3>
                <div class="grid grid-cols-2 gap-3">
                    <!-- é»æ“Šå¼·åŒ– -->
                    <div class="bg-slate-800 p-3 rounded-xl border border-slate-700" onclick="buyUpgrade('click')">
                        <div class="flex justify-between items-start mb-2">
                            <div class="text-2xl">ğŸ’ª</div>
                            <div class="text-xs text-yellow-500 font-bold" id="cost-click">500 Pts</div>
                        </div>
                        <div class="font-bold text-sm">è²“æŒå¼·åŒ–</div>
                        <div class="text-xs text-slate-500">Lv.<span id="lvl-click">1</span> (+1/tap)</div>
                    </div>
                    <!-- èƒ½é‡å›å¾© -->
                    <div class="bg-slate-800 p-3 rounded-xl border border-slate-700" onclick="buyUpgrade('energy')">
                        <div class="flex justify-between items-start mb-2">
                            <div class="text-2xl">âš¡</div>
                            <div class="text-xs text-yellow-500 font-bold" id="cost-energy">1000 Pts</div>
                        </div>
                        <div class="font-bold text-sm">è²“è–„è·é£²æ–™</div>
                        <div class="text-xs text-slate-500">Lv.<span id="lvl-energy">1</span> (+èƒ½é‡ä¸Šé™)</div>
                    </div>
                </div>
            </div>

            <!-- é€ å‹è³¼è²· -->
            <div>
                <h3 class="text-sm text-slate-400 uppercase tracking-wider mb-3 font-bold">ç¨€æœ‰é€ å‹ (NFT)</h3>
                <div class="space-y-3">
                    <div class="bg-slate-800 p-3 rounded-xl border border-slate-700 flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-slate-900 rounded-lg flex items-center justify-center overflow-hidden">
                                <div class="w-6 h-6 bg-orange-400 rounded skin-gold"></div>
                            </div>
                            <div>
                                <div class="font-bold text-yellow-400">é»ƒé‡‘æ‹›è²¡è²“</div>
                                <div class="text-xs text-slate-500">è¢«å‹•ï¼šå¹¸é‹å€¼ UP</div>
                            </div>
                        </div>
                        <button onclick="buySkin('gold', 100000)" id="btn-skin-gold" class="bg-slate-700 text-xs px-3 py-2 rounded text-white border border-slate-600">100k</button>
                    </div>
                    
                    <div class="bg-slate-800 p-3 rounded-xl border border-slate-700 flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-slate-900 rounded-lg flex items-center justify-center overflow-hidden">
                                <div class="w-6 h-6 bg-orange-400 rounded skin-hacker"></div>
                            </div>
                            <div>
                                <div class="font-bold text-green-400">é§­å®¢ä»»å‹™è²“</div>
                                <div class="text-xs text-slate-500">è¢«å‹•ï¼šè‡ªå‹•ä»£ç¢¼</div>
                            </div>
                        </div>
                        <button onclick="buySkin('hacker', 500000)" id="btn-skin-hacker" class="bg-slate-700 text-xs px-3 py-2 rounded text-white border border-slate-600">500k</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- é é¢ 4: è³­å ´ (Lucky) -->
        <div id="page-lucky" class="page-content hidden p-4 flex flex-col items-center">
            <h2 class="text-2xl font-bold text-center mb-2 text-purple-400 font-['Press_Start_2P'] uppercase">æ¯æ—¥è¼ªç›¤</h2>
            <p class="text-xs text-slate-400 mb-8 text-center">æ¯å¤©å…è²»ä¸€æŠ½ï¼Œæ‹¼äººå“çˆ†æ“Š SOL</p>
            
            <div class="relative mb-8">
                <div class="wheel-pointer"></div>
                <div class="wheel-container" id="wheel">
                    <!-- è¼ªç›¤å°‡ç”± JS å‹•æ…‹å¡«å…… -->
                </div>
                <!-- ä¸­å¿ƒé» -->
                <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-10 h-10 bg-white rounded-full border-4 border-slate-200 z-10 shadow-lg flex items-center justify-center">
                    <span class="text-slate-900 font-bold text-xs">0x</span>
                </div>
            </div>

            <button id="spin-btn" onclick="spinWheel()" class="w-full max-w-xs bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold py-4 rounded-xl shadow-lg border-b-4 border-purple-900 active:border-b-0 active:translate-y-1 transition text-xl">
                SPIN !
            </button>
            <p id="spin-result" class="mt-4 font-bold text-yellow-400 min-h-[24px]"></p>
        </div>

    </main>

    <!-- åº•éƒ¨å°èˆªæ¬„ -->
    <nav class="fixed bottom-0 w-full bg-slate-900 border-t border-slate-800 flex justify-around items-center py-2 pb-4 z-50 shadow-2xl">
        <button onclick="switchPage('home')" class="nav-btn active flex flex-col items-center gap-1 w-1/5 text-yellow-500">
            <i class="fa-solid fa-gavel text-xl"></i>
            <span class="text-[10px]">æŒ–ç¤¦</span>
        </button>
        <button onclick="switchPage('earn')" class="nav-btn flex flex-col items-center gap-1 w-1/5 text-slate-500 hover:text-white transition">
            <i class="fa-solid fa-list-check text-xl"></i>
            <span class="text-[10px]">ä»»å‹™</span>
        </button>
        <button onclick="switchPage('lucky')" class="nav-btn flex flex-col items-center gap-1 w-1/5 text-slate-500 hover:text-white transition">
            <div class="relative">
                <i class="fa-solid fa-dice text-xl"></i>
                <span class="absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full animate-ping"></span>
            </div>
            <span class="text-[10px]">è½‰ç›¤</span>
        </button>
        <button onclick="switchPage('shop')" class="nav-btn flex flex-col items-center gap-1 w-1/5 text-slate-500 hover:text-white transition">
            <i class="fa-solid fa-shop text-xl"></i>
            <span class="text-[10px]">å•†åº—</span>
        </button>
    </nav>

    <!-- JavaScript é‚è¼¯ -->
    <script>
        // --- éŠæˆ²æ•¸æ“šçµæ§‹ ---
        const defaultState = {
            score: 0,
            level: 1,
            energy: 1000,
            maxEnergy: 1000,
            clickPower: 1,
            lastLogin: Date.now(),
            tasks: { twitter: false, telegram: false, daily: 0 },
            upgrades: { click: 1, energy: 1 },
            skins: ['default'],
            currentSkin: 'default',
            lastSpin: 0
        };

        let gameState = JSON.parse(localStorage.getItem('0xChonk_v1.8')) || defaultState;

        // --- æ ¸å¿ƒè®Šæ•¸ ---
        const levelThresholds = [0, 5000, 20000, 100000, 500000, 1000000];
        let energyInterval;

        // --- åˆå§‹åŒ– ---
        function init() {
            calculateOfflineEnergy();
            updateUI();
            startEnergyRegen();
            applySkin(gameState.currentSkin);
            renderWheel(); // é›–ç„¶æ˜¯CSSè½‰ç›¤ï¼Œä½†é€™è£¡é ç•™åšé‚è¼¯
            
            // æª¢æŸ¥æ˜¯å¦æ›æ—¥é‡ç½®æ¯æ—¥ç°½åˆ°
            const today = new Date().setHours(0,0,0,0);
            if(gameState.tasks.daily < today) {
                document.getElementById('btn-daily-checkin').classList.remove('opacity-50', 'cursor-not-allowed');
                document.getElementById('btn-daily-checkin').innerText = 'é ˜å–';
                document.getElementById('btn-daily-checkin').onclick = dailyCheckIn;
            } else {
                markDailyClaimed();
            }

            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            checkTaskStatus();
            updateShopUI();
        }

        // --- å­˜æª”ç³»çµ± ---
        function saveGame() {
            localStorage.setItem('0xChonk_v1.8', JSON.stringify(gameState));
        }

        // --- é›¢ç·šæ”¶ç›Š/èƒ½é‡è¨ˆç®— ---
        function calculateOfflineEnergy() {
            const now = Date.now();
            const diff = (now - gameState.lastLogin) / 1000; // ç§’
            const regenAmount = Math.floor(diff * 1); // æ¯ç§’å›1é»
            gameState.energy = Math.min(gameState.maxEnergy, gameState.energy + regenAmount);
            gameState.lastLogin = now;
            saveGame();
        }

        // --- èƒ½é‡å›å¾©å¾ªç’° ---
        function startEnergyRegen() {
            clearInterval(energyInterval);
            energyInterval = setInterval(() => {
                if (gameState.energy < gameState.maxEnergy) {
                    gameState.energy += 1; // åŸºç¤å›å¾©
                    updateUI();
                    saveGame();
                }
            }, 1000); // æ¯ç§’
        }

        // --- é»æ“Šæ ¸å¿ƒé‚è¼¯ ---
        const clickZone = document.getElementById('click-zone');
        
        clickZone.addEventListener('pointerdown', (e) => {
            // é˜²æ­¢ç¸®æ”¾
            e.preventDefault();

            if (gameState.energy >= gameState.clickPower) {
                // 1. éœ‡å‹•åé¥‹ (Haptic)
                if (navigator.vibrate) navigator.vibrate(10);

                // 2. æ‰£é™¤èƒ½é‡ & å¢åŠ åˆ†æ•¸
                gameState.energy -= gameState.clickPower;
                
                // çˆ†æ“Šåˆ¤å®š (10%æ©Ÿç‡ 3å€)
                let isCrit = Math.random() < 0.1;
                let gain = isCrit ? gameState.clickPower * 3 : gameState.clickPower;
                
                gameState.score += gain;

                // 3. æµ®å‹•æ•¸å­—
                createFloatingText(e.clientX, e.clientY, gain, isCrit);

                // 4. æ›´æ–° UI & å­˜æª”
                checkLevelUp();
                updateUI();
                
                // ç°¡å–®é˜²åˆ· (æ¯10æ¬¡å­˜ä¸€æ¬¡ï¼Œæ¸›å°‘IO)
                if(Math.random() < 0.1) saveGame();
            } else {
                // æ²’èƒ½é‡æ™‚çš„ UI åé¥‹
                clickZone.classList.add('grayscale');
                setTimeout(() => clickZone.classList.remove('grayscale'), 200);
            }
        });

        function createFloatingText(x, y, amount, isCrit) {
            const el = document.createElement('div');
            el.className = 'float-number text-2xl ' + (isCrit ? 'text-red-500 text-4xl' : 'text-white');
            el.innerText = isCrit ? `ğŸ”¥ +${amount}` : `+${amount}`;
            
            // éš¨æ©Ÿåç§»ä¸€é»
            const offsetX = (Math.random() - 0.5) * 40;
            
            el.style.left = `${x + offsetX}px`;
            el.style.top = `${y - 50}px`;
            
            document.body.appendChild(el);
            
            setTimeout(() => el.remove(), 800);
        }

        function checkLevelUp() {
            // ç°¡å–®ç­‰ç´šé‚è¼¯
            if (gameState.score > levelThresholds[gameState.level]) {
                gameState.level++;
                // å‡ç´šç‰¹æ•ˆå¯åœ¨æ­¤æ·»åŠ 
                alert(`æ­å–œï¼è‚¥è²“å‡ç´šåˆ°äº† Lv.${gameState.level}`);
            }
        }

        // --- UI æ›´æ–° ---
        function updateUI() {
            document.getElementById('score-display').innerText = gameState.score.toLocaleString();
            document.getElementById('energy-current').innerText = Math.floor(gameState.energy);
            document.getElementById('energy-max').innerText = gameState.maxEnergy;
            document.getElementById('level-display').innerText = gameState.level;
            
            const pct = (gameState.energy / gameState.maxEnergy) * 100;
            document.getElementById('energy-bar').style.width = `${pct}%`;
        }

        // --- é é¢åˆ‡æ› ---
        function switchPage(pageId) {
            document.querySelectorAll('.page-content').forEach(el => el.classList.add('hidden'));
            document.getElementById(`page-${pageId}`).classList.remove('hidden');
            
            // æ›´æ–°æŒ‰éˆ•æ¨£å¼
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('text-yellow-500');
                btn.classList.add('text-slate-500');
            });
            event.currentTarget.classList.remove('text-slate-500');
            event.currentTarget.classList.add('text-yellow-500');
        }

        // --- ä»»å‹™ç³»çµ± ---
        function completeTask(taskId, reward, url) {
            if (url && url !== '#') window.open(url, '_blank');
            
            if (!gameState.tasks[taskId]) {
                setTimeout(() => {
                    // æ¨¡æ“¬é©—è­‰æ™‚é–“
                    gameState.tasks[taskId] = true;
                    gameState.score += reward;
                    saveGame();
                    updateUI();
                    checkTaskStatus();
                    alert(`ä»»å‹™å®Œæˆï¼ç²å¾— ${reward} Pts`);
                }, 2000);
            } else {
                alert('é€™å€‹ä»»å‹™å·²ç¶“åšéäº†å–µï¼');
            }
        }

        function checkTaskStatus() {
            if(gameState.tasks.twitter) {
                const btn = document.getElementById('btn-task-twitter');
                btn.innerText = "å·²å®Œæˆ";
                btn.classList.add('opacity-50', 'bg-green-600');
                btn.disabled = true;
            }
            if(gameState.tasks.telegram) {
                const btn = document.getElementById('btn-task-telegram');
                btn.innerText = "å·²å®Œæˆ";
                btn.classList.add('opacity-50', 'bg-green-600');
                btn.disabled = true;
            }
        }

        function dailyCheckIn() {
            gameState.score += 1000;
            gameState.tasks.daily = new Date().setHours(23,59,59,999); // è¨­ç‚ºä»Šå¤©çµæŸ
            saveGame();
            updateUI();
            markDailyClaimed();
            alert("ç°½åˆ°æˆåŠŸï¼+1000");
        }

        function markDailyClaimed() {
            const btn = document.getElementById('btn-daily-checkin');
            btn.innerText = 'æ˜æ—¥å†ä¾†';
            btn.onclick = null;
            btn.classList.add('opacity-50', 'cursor-not-allowed');
        }

        function copyInvite() {
            navigator.clipboard.writeText("https://t.me/ChonkBot?start=ref_USERID");
            alert("é‚€è«‹é€£çµå·²è¤‡è£½ï¼å»è½Ÿç‚¸ç¾¤çµ„å§ï¼");
        }

        // --- å•†åº—ç³»çµ± ---
        function updateShopUI() {
            // åŸºç¤åƒ¹æ ¼å…¬å¼
            const clickCost = Math.floor(500 * Math.pow(1.5, gameState.upgrades.click));
            const energyCost = Math.floor(1000 * Math.pow(1.5, gameState.upgrades.energy));
            
            document.getElementById('cost-click').innerText = clickCost + ' Pts';
            document.getElementById('lvl-click').innerText = gameState.upgrades.click;
            
            document.getElementById('cost-energy').innerText = energyCost + ' Pts';
            document.getElementById('lvl-energy').innerText = gameState.upgrades.energy;

            // é€ å‹æŒ‰éˆ•ç‹€æ…‹
            if(gameState.skins.includes('gold')) {
                const btn = document.getElementById('btn-skin-gold');
                if(gameState.currentSkin === 'gold') {
                    btn.innerText = "ä½¿ç”¨ä¸­";
                    btn.className = "bg-green-600 text-xs px-3 py-2 rounded text-white";
                } else {
                    btn.innerText = "è£å‚™";
                    btn.onclick = () => equipSkin('gold');
                    btn.className = "bg-blue-600 text-xs px-3 py-2 rounded text-white";
                }
            }
            if(gameState.skins.includes('hacker')) {
                const btn = document.getElementById('btn-skin-hacker');
                if(gameState.currentSkin === 'hacker') {
                    btn.innerText = "ä½¿ç”¨ä¸­";
                    btn.className = "bg-green-600 text-xs px-3 py-2 rounded text-white";
                } else {
                    btn.innerText = "è£å‚™";
                    btn.onclick = () => equipSkin('hacker');
                    btn.className = "bg-blue-600 text-xs px-3 py-2 rounded text-white";
                }
            }
        }

        function buyUpgrade(type) {
            let cost = 0;
            if (type === 'click') {
                cost = Math.floor(500 * Math.pow(1.5, gameState.upgrades.click));
                if (gameState.score >= cost) {
                    gameState.score -= cost;
                    gameState.upgrades.click++;
                    gameState.clickPower++; // ç°¡å–® +1
                    saveGame();
                    updateUI();
                    updateShopUI();
                    alert("å‡ç´šæˆåŠŸï¼é»æ“ŠåŠ› UPï¼");
                } else {
                    alert("çª®é¬¼ï¼éŒ¢ä¸å¤ å–µï¼");
                }
            } else if (type === 'energy') {
                cost = Math.floor(1000 * Math.pow(1.5, gameState.upgrades.energy));
                if (gameState.score >= cost) {
                    gameState.score -= cost;
                    gameState.upgrades.energy++;
                    gameState.maxEnergy += 500;
                    gameState.energy = gameState.maxEnergy; // è£œæ»¿
                    saveGame();
                    updateUI();
                    updateShopUI();
                    alert("å‡ç´šæˆåŠŸï¼é«”åŠ›ä¸Šé™ UPï¼");
                } else {
                    alert("çª®é¬¼ï¼éŒ¢ä¸å¤ å–µï¼");
                }
            }
        }

        function buySkin(skinId, price) {
            if (gameState.skins.includes(skinId)) return; // å·²æ“æœ‰
            
            if (gameState.score >= price) {
                gameState.score -= price;
                gameState.skins.push(skinId);
                saveGame();
                updateUI();
                updateShopUI(); // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
                alert("è³¼è²·æˆåŠŸï¼å»è£å‚™å§ï¼");
            } else {
                alert("éŒ¢ä¸å¤ ï¼å¿«å»æŒ–ç¤¦ï¼");
            }
        }

        function equipSkin(skinId) {
            gameState.currentSkin = skinId;
            applySkin(skinId);
            saveGame();
            updateShopUI();
        }

        function applySkin(skinId) {
            const avatar = document.getElementById('cat-avatar');
            // ç§»é™¤æ‰€æœ‰èˆŠ skin class
            avatar.classList.remove('skin-default', 'skin-gold', 'skin-hacker', 'skin-neon');
            // åŠ å…¥æ–°çš„
            avatar.classList.add(`skin-${skinId}`);
        }

        // --- è½‰ç›¤é‚è¼¯ (CSS + JS) ---
        let isSpinning = false;
        
        function spinWheel() {
            if (isSpinning) return;
            
            // æª¢æŸ¥å†·å» (24å°æ™‚) - é€™è£¡ç‚ºäº†æ¸¬è©¦æ–¹ä¾¿è¨­ç‚º 60ç§’
            const now = Date.now();
            if (now - gameState.lastSpin < 60000) { 
                const wait = Math.ceil((60000 - (now - gameState.lastSpin))/1000);
                alert(`é‚„åœ¨å†·å»ä¸­ï¼è«‹ç­‰å¾… ${wait} ç§’`);
                return;
            }

            isSpinning = true;
            document.getElementById('spin-result').innerText = "";
            
            // éš¨æ©Ÿè§’åº¦: è‡³å°‘è½‰5åœˆ (1800åº¦) + éš¨æ©Ÿè§’åº¦
            const extraDeg = Math.floor(Math.random() * 360);
            const totalDeg = 1800 + extraDeg; 
            
            const wheel = document.getElementById('wheel');
            wheel.style.transition = 'transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99)';
            wheel.style.transform = `rotate(${totalDeg}deg)`;

            // è¨ˆç®—çå‹µ (åŸºæ–¼è§’åº¦)
            // 8å€‹å€å¡Šï¼Œæ¯å€‹45åº¦ã€‚æŒ‡é‡åœ¨ä¸Šæ–¹(0åº¦)ã€‚
            // å¯¦éš›è½åœ¨çš„è§’åº¦ = totalDeg % 360ã€‚
            // ç”±æ–¼ç›¤é¢é †æ™‚é‡è½‰ï¼ŒæŒ‡é‡ç›¸å°ç›¤é¢æ˜¯é€†æ™‚é‡æƒéã€‚
            // ç°¡åŒ–é‚è¼¯ï¼šç´”éš¨æ©Ÿçµ¦çå‹µï¼Œå‹•ç•«åªæ˜¯éå ´
            
            setTimeout(() => {
                isSpinning = false;
                gameState.lastSpin = Date.now();
                
                // æ¨¡æ“¬çµæœ
                const rewards = [100, 500, 1000, 0, 2000, 5000, 100, 10000];
                const finalReward = rewards[Math.floor(Math.random() * rewards.length)];
                
                if(finalReward > 0) {
                    gameState.score += finalReward;
                    document.getElementById('spin-result').innerText = `WIN: ${finalReward} Pts!`;
                    alert(`æ­å–œç²å¾— ${finalReward} åˆ†ï¼`);
                } else {
                    document.getElementById('spin-result').innerText = `Bad Luck...`;
                    alert(`å¹«QQï¼Œæ²’ä¸­ç...`);
                }
                
                saveGame();
                updateUI();
                
                // é‡ç½®è½‰ç›¤è§’åº¦ (ç‚ºäº†ä¸‹æ¬¡å‹•ç•«) - å¯¦éš›é …ç›®å¯èƒ½éœ€è¦æ›´è¤‡é›œçš„é‡ç½®é‚è¼¯
                wheel.style.transition = 'none';
                wheel.style.transform = `rotate(${totalDeg % 360}deg)`;
            }, 4000);
        }

        // å•Ÿå‹•
        init();

    </script>
</body>
</html>

